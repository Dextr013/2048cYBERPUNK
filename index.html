<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="color-scheme" content="dark light" />
    <title>2048 Cybergrid</title>
    <link rel="preload" as="image" href="bg6.png" />
    <link rel="preload" as="image" href="digit 2.png" />
    <link rel="preload" as="image" href="digit 4.png" />
    <link rel="preload" as="image" href="digit 8.png" />
    <link rel="preload" as="image" href="digit 16.png" />
    <link rel="preload" as="image" href="digit 32.png" />
    <link rel="preload" as="image" href="digit 64.png" />
    <link rel="preload" as="image" href="digit 128.png" />
    <link rel="preload" as="image" href="digit 256.png" />
    <link rel="preload" as="image" href="digit 512.png" />
    <link rel="preload" as="image" href="digit 1024.png" />
    <link rel="preload" as="image" href="digit 2048.png" />
    <link rel="stylesheet" href="styles.css">
    <!-- Speed up potential Yandex SDK/connects -->
    <link rel="preconnect" href="https://yandex.ru" crossorigin>
    <link rel="preconnect" href="https://yandex.ru/games" crossorigin>
    <!-- Minimal critical CSS for early paint (preloader + base) -->
    <style>
      html,body{height:100%}
      body{margin:0;background:#000;color:#c9f5ff;font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
      .hidden{display:none}
      .preloader{position:fixed;inset:0;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;background:#000}
      .spinner{width:42px;height:42px;border-radius:50%;border:4px solid rgba(255,255,255,.12);border-top-color:#00e0ff;animation:spin .9s linear infinite}
      @keyframes spin{to{transform:rotate(360deg)}}
    </style>
    <script>
      (function(){
        var done=false;
        function markReady(){
          if(done) return; done=true;
          try{var pre=document.getElementById('preloader'); var app=document.getElementById('app'); if(pre) pre.classList.add('hidden'); if(app) app.classList.remove('hidden');}catch(e){}
          try{ if(window.YaGames && window.YaGames.init){ window.YaGames.init().then(function(y){ try{ y && y.features && y.features.LoadingAPI && y.features.LoadingAPI.ready && y.features.LoadingAPI.ready(); }catch(e){} }).catch(function(){}); } }catch(e){}
          try{ window.dispatchEvent(new Event('gameready')); }catch(e){}
          try{ window.parent && window.parent.postMessage({ type:'game_ready' }, '*'); }catch(e){}
        }
        function poll(){ if(done) return; if(window.YaGames && window.YaGames.init){ markReady(); return; } setTimeout(poll,150); }
        if(document.readyState !== 'loading'){ setTimeout(markReady, 1200); } else { document.addEventListener('DOMContentLoaded', function(){ setTimeout(markReady, 1200); }); }
        try{ poll(); }catch(e){}
        window.__boot_timeout = setTimeout(markReady, 4000);
      })();
    </script>
  </head>
  <body>
    <div id="preloader" class="preloader">
      <div class="spinner"></div>
      <div id="preloader-text">Loading…</div>
    </div>

          <div id="app" class="hidden">
      <div class="hud">
        <div class="brand">
          <span class="title" data-i18n="title">2048 Cybergrid</span>
          <button id="btn-new" class="btn" data-i18n="newGame">New Game</button>
        </div>
        <div class="stats">
          <div class="stat"><span data-i18n="score">Score</span><strong id="score">0</strong></div>
          <div class="stat"><span data-i18n="best">Best</span><strong id="best">0</strong></div>
        </div>
        <div class="controls">
          <button id="btn-sound" class="btn toggle" aria-pressed="false" data-i18n="soundOn">Sound</button>
          <select id="lang-select" class="select"></select>
          <button id="btn-settings" class="btn" data-i18n="settings">Settings</button>
          <button id="btn-auth" class="btn" data-i18n="signIn">Sign In</button>
          <button id="btn-lb" class="btn" data-i18n="leaderboard">Leaderboard</button>
        </div>
      </div>

      <div class="game-container">
        <canvas id="game-canvas" width="480" height="640" aria-label="game"></canvas>
        <div id="overlay" class="overlay hidden">
          <div class="overlay-content">
            <div id="overlay-title" class="overlay-title">2048</div>
            <div id="overlay-sub" class="overlay-sub">—</div>
            <div class="overlay-actions">
              <button id="btn-continue" class="btn primary" data-i18n="continue">Continue</button>
              <button id="btn-restart" class="btn" data-i18n="restart">Restart</button>
            </div>
          </div>
        </div>
        <div id="lb-overlay" class="overlay hidden">
          <div class="overlay-content">
            <div class="overlay-title" data-i18n="leaderboard">Leaderboard</div>
            <div id="lb-list" class="lb-list"></div>
            <div class="overlay-actions">
              <button id="btn-lb-close" class="btn" data-i18n="close">Close</button>
            </div>
          </div>
        </div>
      </div>

      <footer class="footer">
        <span>© 2025</span>
      </footer>
    </div>

    <script type="module" src="src/main.js"></script>
  </body>
</html>